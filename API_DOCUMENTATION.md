# üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API - –í—Ö–æ–¥–Ω—ã–µ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –≤ –±—ç–∫–µ–Ω–¥–µ

### ‚úÖ **–†–∞–±–æ—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

#### 1. **GET /api/masks** - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞—Å–æ–∫

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ù–µ—Ç
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
[
  {
    "id": 5,
    "name": "BASE",
    "instructions": "–°–≤–∞—Ä–æ—á–Ω–∞—è –º–∞—Å–∫–∞ —Ö–∞–º–µ–ª–µ–æ–Ω FITSIZ STARTER BASE",
    "imageUrl": "https://...",
    "price": "1 021,38 ‚ÇΩ",
    "weight": "",
    "viewArea": "94x30 –º–º",
    "sensors": 2,
    "power": "DIN 4",
    "shadeRange": "DIN 4/11",
    "material": "Starter",
    "description": "FSC-B101",
    "link": null,
    "installment": null,
    "size": null,
    "days": null,
    "batteryIndicator": "",
    "hdColorTech": "",
    "memoryModes": "",
    "weldingTypes": "MMA, MIG/MAG",
    "gradientFunction": "",
    "testButton": "",
    "sFireProtection": "",
    "delayAdjustment": "",
    "sensitivityAdjustment": "",
    "operatingTemp": "–æ—Ç -10¬∞C –¥–æ +55¬∞C",
    "opticalClass": "",
    "responseTime": "",
    "headband": "",
    "packageHeight": "",
    "packageLength": "",
    "packageWidth": "",
    "features": [],
    "reviews": [],
    "ExtraField": []
  }
]
```

#### 2. **GET /api/masks/:id** - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∞—Å–∫–∏

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** `id` (–ø–∞—Ä–∞–º–µ—Ç—Ä URL)
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–±—ä–µ–∫—Ç –º–∞—Å–∫–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

#### 3. **GET /api/masks/:id/instructions** - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** `id` (–ø–∞—Ä–∞–º–µ—Ç—Ä URL)
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "instructions": "–°–≤–∞—Ä–æ—á–Ω–∞—è –º–∞—Å–∫–∞ —Ö–∞–º–µ–ª–µ–æ–Ω FITSIZ STARTER BASE"
}
```

#### 4. **GET /api/videos** - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ù–µ—Ç
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
[
  {
    "id": 2,
    "title": "–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–∞—Ä–æ—á–Ω—É—é –º–∞—Å–∫—É ELEMENT STATIC?",
    "url": "<iframe src=\"https://vk.com/video_ext.php?...\"></iframe>",
    "description": null,
    "duration": "07:05",
    "thumbnailUrl": "https://i.pinimg.com/..."
  }
]
```

#### 5. **POST /api/register** - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "telegramId": "string (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
  "firstName": "string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "id": 51,
  "telegramId": "test123",
  "firstName": "Test",
  "phone": null,
  "email": null,
  "isBotAvailable": false,
  "quiz": false,
  "createdAt": "2025-10-19T02:11:41.848Z"
}
```

#### 6. **GET /api/user/:telegramId** - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** `telegramId` (–ø–∞—Ä–∞–º–µ—Ç—Ä URL)
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –û–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 7. **POST /api/user/:telegramId/add-mask** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "maskId": "number (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "id": 2,
  "userId": 51,
  "maskId": 5
}
```

#### 8. **GET /api/user/:telegramId/masks** - –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** `telegramId` (–ø–∞—Ä–∞–º–µ—Ç—Ä URL)
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ú–∞—Å—Å–∏–≤ –º–∞—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

#### 9. **POST /api/profile** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "telegramId": "string (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
  "firstName": "string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "phone": "string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "email": "string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "maskId": "number (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "quiz": "boolean (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
  "add": "boolean (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "id": 51,
  "telegramId": "test123",
  "firstName": "Updated Name",
  "phone": "+1234567890",
  "email": null,
  "isBotAvailable": true,
  "quiz": false
}
```

#### 10. **POST /api/admin/login** - –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
{
  "username": "string (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
  "password": "string (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö):**

```json
{
  "error": "Invalid credentials"
}
```

#### 11. **GET /api/admin/users** - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (‚ö†Ô∏è –ë–ï–ó –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò!)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ù–µ—Ç
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
[
  {
    "id": 90,
    "telegramId": "796810417",
    "firstName": "–ö–∞—Ç—é—à–∞",
    "isBotAvailable": true
  }
]
```

#### 12. **GET /api/admin/settings** - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (‚ö†Ô∏è –ë–ï–ó –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò!)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ù–µ—Ç
**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```json
[
  {
    "key": "TG_MESSAGE_ON_ADD_MASK",
    "value": null
  }
]
```

### ‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

#### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π - –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö `/api/admin/*` —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### üîß **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é:**

#### 1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å middleware clearPreparedStatements**

```javascript
// –ü—Ä–æ–±–ª–µ–º–∞: middleware –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
// –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
async function clearPreparedStatementsMiddleware(req, res, next) {
  try {
    // –ª–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏
    next();
  } catch (error) {
    console.warn("Middleware error:", error.message);
    next(); // –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  }
}
```

#### 2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö**

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
const validateProfileData = (data) => {
  if (data.phone && typeof data.phone !== "string") {
    throw new Error("Phone must be a string");
  }
  if (data.email && typeof data.email !== "string") {
    throw new Error("Email must be a string");
  }
  return true;
};
```

#### 3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

```javascript
// –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
exports.updateProfile = async (req, res) => {
  try {
    console.log("Profile update request:", req.body);
    // –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  } catch (error) {
    console.error("Profile update error:", {
      message: error.message,
      stack: error.stack,
      body: req.body,
    });
    res.status(500).json({ error: error.message });
  }
};
```

#### 4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

- –î–æ–±–∞–≤–∏—Ç—å rate limiting
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
- –î–æ–±–∞–≤–∏—Ç—å CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API:**

- **–í—Å–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:** 20+
- **–†–∞–±–æ—Ç–∞—é—â–∏—Ö:** 12
- **–ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö:** 0
- **–ê–¥–º–∏–Ω—Å–∫–∏—Ö:** 12 (‚ö†Ô∏è –ë–ï–ó –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò!)
- **–ü—É–±–ª–∏—á–Ω—ã—Ö:** 8

### üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–ö–†–ò–¢–ò–ß–ù–û:** –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
2. **–í—ã—Å–æ–∫–∏–π:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–í—ã—Å–æ–∫–∏–π:** –î–æ–±–∞–≤–∏—Ç—å rate limiting
4. **–°—Ä–µ–¥–Ω–∏–π:** –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
5. **–ù–∏–∑–∫–∏–π:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
